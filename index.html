<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>James Watts’ Portfolio</title>

<style>
:root{
  --page-gap: 18px;
  --bg: #ffffff;
  --page-bg: #ffffff;
  --text: #111;
  --muted: rgba(0,0,0,0.55);
  --border: rgba(0,0,0,0.10);
  --shadow: 0 6px 18px rgba(0,0,0,0.12);
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

/* ================= HEADER ================= */

header{
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:24px;
  padding:12px 14px;
  background:rgba(255,255,255,0.88);
  backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
  flex-wrap:wrap;
}

/* Smooth hide/show of the sticky top bar */
header,
#loadingBar{
  transition: transform 220ms ease;
  will-change: transform;
}

body.top-hidden header,
body.top-hidden #loadingBar{
  transform: translateY(-120%);
}

.brand{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}
.brand .title{ font-weight:600; font-size:16px; }
.brand .sub{ font-size:12px; color:var(--muted); }

.tabs{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}

.tab{
  border:1px solid var(--border);
  background:#fff;
  color:var(--text);
  border-radius:999px;
  padding:8px 12px;
  font-size:13px;
  cursor:pointer;
}
.tab:hover{
  box-shadow:0 2px 10px rgba(0,0,0,0.06);
  border-color: rgba(0,0,0,0.18);
}
.tab[aria-selected="true"]{
  font-weight:600;
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
  border-color: rgba(0,0,0,0.22);
}

/* Divider between last tab and download */
.divider{
  width:1px;
  height:28px;
  background: rgba(0,0,0,0.15);
  align-self:center;
}

/* Download button */
.download{
  border:1px solid var(--border);
  background:#fff;
  border-radius:999px;
  padding:8px 14px;
  font-size:13px;
  cursor:pointer;
  text-decoration:none;
  color:var(--text);
  white-space:nowrap;
}
.download:hover{
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
  border-color: rgba(0,0,0,0.18);
}

/* ================= LOADING BAR ================= */

#loadingBar{
  position:sticky;
  top:56px;
  height:3px;
  width:100%;
  opacity:0;
  transition:opacity 160ms ease;
  z-index:9;
  background: transparent;
}
#loadingBar.show{ opacity:1; }
#loadingBarInner{
  height:100%;
  width:0%;
  background:rgba(0,0,0,0.35);
  border-radius:999px;
  transition:width 180ms ease;
}

/* ================= PDF VIEWER ================= */

#viewer{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:var(--page-gap);
  padding:20px 10px 60px;
}

.page{
  width:min(1100px,96vw);
  background:var(--page-bg);
  border-radius: 4px;
  border:1px solid var(--border);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  overflow:hidden;
}

.page canvas{ width:100%; display:block; }

.skeleton{
  width:100%;
  aspect-ratio:8.5/11;
  background:linear-gradient(90deg,#f4f4f4,#ededed,#f4f4f4);
  background-size:200% 100%;
  animation:shimmer 1.2s infinite linear;
}
@keyframes shimmer{
  from{background-position:200% 0}
  to{background-position:-200% 0}
}

/* ================= MOBILE ================= */

@media (max-width:640px){
  header{
    flex-direction:column;
    gap:8px;
  }

  /* Loading bar sits below taller header on mobile */
  #loadingBar{ top:96px; }

  /* Hide the vertical divider when stacked */
  .divider{ display:none; }

  /* Smaller buttons so tabs + Download fit on one line */
  .tab,
  .download{
    font-size:10px;
    padding:5px 9px;
  }
}
</style>
</head>

<body>

<header>
  <div class="brand">
    <div class="title">James Watts’ Portfolio</div>
    <div class="sub">2021–2026</div>
  </div>

  <nav class="tabs" aria-label="Document tabs">
    <button class="tab" aria-selected="true"  data-pdf="resume.pdf">Resume</button>
    <button class="tab" aria-selected="false" data-pdf="portfolio.pdf">Portfolio</button>
    <button class="tab" aria-selected="false" data-pdf="glass-construction-manual.pdf">Glass Manual</button>
  </nav>

  <div class="divider" aria-hidden="true"></div>

  <a id="downloadBtn" class="download" href="resume.pdf" download>
    Download PDF
  </a>
</header>

<div id="loadingBar" aria-hidden="true"><div id="loadingBarInner"></div></div>

<main id="viewer"></main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const viewer = document.getElementById("viewer");
const tabs = Array.from(document.querySelectorAll(".tab"));
const downloadBtn = document.getElementById("downloadBtn");
const loadingBar = document.getElementById("loadingBar");
const loadingBarInner = document.getElementById("loadingBarInner");

let observer = null;
let loadToken = 0;
const TARGET_WIDTH = 1100;

function showLoading(){
  loadingBar.classList.add("show");
  loadingBarInner.style.width = "8%";
}
function setProgress(p){
  loadingBarInner.style.width = Math.max(0, Math.min(100, p)) + "%";
}
function hideLoading(){
  setProgress(100);
  setTimeout(() => {
    loadingBar.classList.remove("show");
    loadingBarInner.style.width = "0%";
  }, 250);
}

function clearViewer(){
  viewer.innerHTML = "";
  if(observer){ observer.disconnect(); observer = null; }
}

function setActive(tab){
  tabs.forEach(t => t.setAttribute("aria-selected", t === tab ? "true" : "false"));
  downloadBtn.href = tab.dataset.pdf;
}

async function loadPdf(url){
  const token = ++loadToken;

  clearViewer();
  showLoading();
  setProgress(10);

  try{
    const task = pdfjsLib.getDocument({ url, withCredentials: false });
    task.onProgress = (p) => {
      if(p && p.total){
        setProgress(10 + (p.loaded / p.total) * 60); // 10% -> 70% while downloading
      }
    };

    const pdf = await task.promise;
    if(token !== loadToken) return;

    setProgress(75);

    // Create page shells immediately for scroll height
    for(let i = 1; i <= pdf.numPages; i++){
      const shell = document.createElement("div");
      shell.className = "page";
      shell.dataset.page = String(i);
      shell.innerHTML = '<div class="skeleton"></div>';
      viewer.appendChild(shell);
    }

    observer = new IntersectionObserver(async (entries) => {
      for(const e of entries){
        if(!e.isIntersecting) continue;
        observer.unobserve(e.target);

        // If user switched docs mid-render, stop
        if(token !== loadToken) return;

        const pageNumber = Number(e.target.dataset.page);

        try{
          const page = await pdf.getPage(pageNumber);
          const vp1 = page.getViewport({ scale: 1 });
          const scale = TARGET_WIDTH / vp1.width;
          const vp = page.getViewport({ scale });

          const canvas = document.createElement("canvas");
          canvas.width = Math.floor(vp.width);
          canvas.height = Math.floor(vp.height);

          e.target.innerHTML = "";
          e.target.appendChild(canvas);

          await page.render({ canvasContext: canvas.getContext("2d"), viewport: vp }).promise;

          // 75% -> 98% as pages render
          setProgress(75 + (pageNumber / pdf.numPages) * 23);

          // Hide once the doc is usable (after page 1 renders)
          if(pageNumber === 1) hideLoading();

        } catch(err){
          // Fail gracefully for a single page
          e.target.innerHTML =
            '<div style="padding:16px;color:#700;border:1px solid rgba(180,0,0,0.18);background:rgba(255,0,0,0.04);border-radius:12px;margin:10px;">' +
            'Failed to render page ' + pageNumber + '.</div>';
          hideLoading();
        }
      }
    }, { rootMargin: "900px 0px" });

    document.querySelectorAll(".page").forEach(p => observer.observe(p));

  } catch(err){
    hideLoading();
    viewer.innerHTML =
      '<div style="max-width:900px;margin:30px auto;padding:16px;border:1px solid rgba(180,0,0,0.18);background:rgba(255,0,0,0.04);border-radius:12px;color:#700;">' +
      '<strong>Couldn’t load the PDF:</strong> <code>' + url + '</code><br><br>' +
      '<code>' + String(err) + '</code><br><br>' +
      'Make sure the PDF is in the same repo folder as <code>index.html</code> and the filename matches exactly.' +
      '</div>';
  }
}

/* Tab click handler */
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    setActive(tab);
    window.scrollTo({ top: 0, behavior: "instant" });
    loadPdf(tab.dataset.pdf);
  });
});

/* Initial load (whatever tab has aria-selected="true") */
const startTab = document.querySelector('.tab[aria-selected="true"]') || tabs[0];
setActive(startTab);
loadPdf(startTab.dataset.pdf);

/* Hide header on scroll down, show on scroll up (desktop + mobile) */
let lastY = window.scrollY;
let ticking = false;

function updateTopBar(){
  const y = window.scrollY;
  const delta = y - lastY;

  // Always show near the very top
  if (y < 10){
    document.body.classList.remove("top-hidden");
    lastY = y;
    ticking = false;
    return;
  }

  // Avoid jitter
  if (Math.abs(delta) > 8){
    if (delta > 0){
      document.body.classList.add("top-hidden");   // scrolling down
    } else {
      document.body.classList.remove("top-hidden"); // scrolling up
    }
    lastY = y;
  }

  ticking = false;
}

window.addEventListener("scroll", () => {
  if (!ticking){
    window.requestAnimationFrame(updateTopBar);
    ticking = true;
  }
}, { passive: true });
</script>

</body>
</html>


