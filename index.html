<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>James Watts’ Portfolio</title>

<style>
:root{
  --page-gap: 18px;
  --bg: #ffffff;
  --page-bg: #ffffff;
  --text: #111;
  --muted: rgba(0,0,0,0.55);
  --border: rgba(0,0,0,0.12);
  --shadow: 0 6px 18px rgba(0,0,0,0.12);
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

/* ================= HEADER ================= */

header{
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  padding:12px 14px;
  background:rgba(255,255,255,0.9);
  backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
}

/* Hide/show header on scroll */
header,
#loadingBar{
  transition:transform 220ms ease;
  will-change:transform;
}
body.top-hidden header,
body.top-hidden #loadingBar{
  transform:translateY(-120%);
}

.brand{
  text-align:center;
}
.brand .title{
  font-weight:600;
  font-size:16px;
}
.brand .sub{
  font-size:12px;
  color:var(--muted);
}

/* Controls row (tabs + divider + download) */
.controls{
  display:flex;
  align-items:center;
  gap:12px;
}

/* Tabs */
.tabs{
  display:flex;
  gap:8px;
  align-items:center;
}

.tab{
  border:1px solid var(--border);
  background:#fff;
  border-radius:999px;
  padding:8px 12px;
  font-size:13px;
  cursor:pointer;
}
.tab[aria-selected="true"]{
  font-weight:600;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

/* Divider */
.divider{
  width:1px;
  height:26px;
  background:rgba(0,0,0,0.18);
}

/* Download button */
.download{
  border:1px solid var(--border);
  background:#fff;
  border-radius:999px;
  padding:8px 14px;
  font-size:13px;
  cursor:pointer;
  text-decoration:none;
  color:var(--text);
  white-space:nowrap;
}
.download:hover{
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

/* ================= LOADING BAR ================= */

#loadingBar{
  position:sticky;
  top:78px;
  height:3px;
  width:100%;
  opacity:0;
}
#loadingBar.show{ opacity:1; }
#loadingBarInner{
  height:100%;
  width:0%;
  background:rgba(0,0,0,0.35);
  transition:width 180ms ease;
}

/* ================= PDF VIEWER ================= */

#viewer{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:var(--page-gap);
  padding:20px 10px 60px;
}

.page{
  width:min(1100px,96vw);
  background:#fff;
  border:1px solid #ddd;
  box-shadow:none;
}

.page canvas{
  width:100%;
  display:block;
}

.skeleton{
  width:100%;
  aspect-ratio:8.5/11;
  background:linear-gradient(90deg,#f4f4f4,#ededed,#f4f4f4);
  background-size:200% 100%;
  animation:shimmer 1.2s infinite linear;
}
@keyframes shimmer{
  from{background-position:200% 0}
  to{background-position:-200% 0}
}

/* ================= MOBILE ================= */

@media (max-width:640px){
  /* Keep everything on ONE line */
  .controls{
    flex-wrap:nowrap;
    gap:6px;
  }

  .tabs{
    flex-wrap:nowrap;
    gap:6px;
  }

  /* Smaller buttons so Download fits inline */
  .tab,
  .download{
    font-size:11px;
    padding:6px 8px;
  }

  .divider{
    height:20px;
  }

  #loadingBar{
    top:92px;
  }
}
</style>
</head>

<body>

<header>
  <div class="brand">
    <div class="title">James Watts’ Portfolio</div>
    <div class="sub">2021–2026</div>
  </div>

  <div class="controls">
    <nav class="tabs" aria-label="Document tabs">
      <button class="tab" aria-selected="true" data-pdf="resume.pdf">Resume</button>
      <button class="tab" aria-selected="false" data-pdf="portfolio.pdf">Portfolio</button>
      <button class="tab" aria-selected="false" data-pdf="glass-construction-manual.pdf">Glass Manual</button>
    </nav>

    <div class="divider"></div>

    <a id="downloadBtn" class="download" href="resume.pdf" download>
      Download PDF
    </a>
  </div>
</header>

<div id="loadingBar"><div id="loadingBarInner"></div></div>

<main id="viewer"></main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const viewer = document.getElementById("viewer");
const tabs = Array.from(document.querySelectorAll(".tab"));
const downloadBtn = document.getElementById("downloadBtn");
const loadingBar = document.getElementById("loadingBar");
const loadingBarInner = document.getElementById("loadingBarInner");

let observer = null;
let token = 0;
const TARGET_WIDTH = 1100;

/* Loading helpers */
function showLoading(){
  loadingBar.classList.add("show");
  loadingBarInner.style.width = "8%";
}
function setProgress(p){
  loadingBarInner.style.width = Math.min(100,p) + "%";
}
function hideLoading(){
  setProgress(100);
  setTimeout(()=>{
    loadingBar.classList.remove("show");
    loadingBarInner.style.width="0%";
  },250);
}

function clearViewer(){
  viewer.innerHTML="";
  if(observer){ observer.disconnect(); observer=null; }
}

function setActive(tab){
  tabs.forEach(t=>t.setAttribute("aria-selected",t===tab));
  downloadBtn.href = tab.dataset.pdf;
}

async function loadPdf(url){
  const my = ++token;
  clearViewer();
  showLoading();
  setProgress(10);

  const task = pdfjsLib.getDocument(url);
  task.onProgress = p=>{
    if(p.total) setProgress(10+(p.loaded/p.total)*60);
  };

  const pdf = await task.promise;
  if(my!==token) return;
  setProgress(75);

  for(let i=1;i<=pdf.numPages;i++){
    const d=document.createElement("div");
    d.className="page";
    d.dataset.p=i;
    d.innerHTML='<div class="skeleton"></div>';
    viewer.appendChild(d);
  }

  observer=new IntersectionObserver(async entries=>{
    for(const e of entries){
      if(!e.isIntersecting) continue;
      observer.unobserve(e.target);
      const p=+e.target.dataset.p;
      const page=await pdf.getPage(p);
      const v1=page.getViewport({scale:1});
      const s=TARGET_WIDTH/v1.width;
      const v=page.getViewport({scale:s});
      const c=document.createElement("canvas");
      c.width=v.width; c.height=v.height;
      e.target.innerHTML="";
      e.target.appendChild(c);
      await page.render({canvasContext:c.getContext("2d"),viewport:v}).promise;
      setProgress(75+(p/pdf.numPages)*23);
      if(p===1) hideLoading();
    }
  },{rootMargin:"900px"});
  document.querySelectorAll(".page").forEach(p=>observer.observe(p));
}

/* Tabs */
tabs.forEach(t=>{
  t.addEventListener("click",()=>{
    setActive(t);
    window.scrollTo({top:0});
    loadPdf(t.dataset.pdf);
  });
});

/* Initial load */
const start=tabs.find(t=>t.getAttribute("aria-selected")==="true")||tabs[0];
setActive(start);
loadPdf(start.dataset.pdf);

/* Hide header on scroll down, show on scroll up */
let lastY=window.scrollY, ticking=false;
window.addEventListener("scroll",()=>{
  if(ticking) return;
  ticking=true;
  requestAnimationFrame(()=>{
    const y=window.scrollY;
    if(y<10){ document.body.classList.remove("top-hidden"); }
    else if(y>lastY+8){ document.body.classList.add("top-hidden"); }
    else if(y<lastY-8){ document.body.classList.remove("top-hidden"); }
    lastY=y;
    ticking=false;
  });
},{passive:true});
</script>

</body>
</html>
